{%- style -%}
  .fixed-overlay-section {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100vh;
    z-index: 900;
    pointer-events: none;
    color: var(--overlay-color, #ffffff);
    transition: color 0.3s ease;
  }

  /* =========================
   OVERLAY LAYOUT
========================= */
  .overlay-content {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .overlay-item {
    position: absolute;
    pointer-events: auto;
    font-family: sans-serif;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 500;
  }

  .overlay-item a {
    color: inherit;
    text-decoration: none;
    transition: opacity 0.2s ease;
  }
  .overlay-item a:hover {
    opacity: 0.7;
  }

  /* =========================
   TOP / BOTTOM
========================= */
  .overlay-top-left {
    top: 2rem;
    left: 2rem;
    display: flex;
    gap: 1.5rem;
  }

  .overlay-bottom-left {
    bottom: 2rem;
    left: 2rem;
  }

  /* =========================
   MIDDLE LEFT (TEXT â†’ LOGO)
========================= */
  .overlay-middle-left {
    top: 50%;
    left: 2rem;
    transform: translateY(-50%);
  }

  .brand-logo-container {
    position: relative;
    display: flex;
    align-items: center;
  }

  .fixed-brand-name {
    font-family: 'Times New Roman', Times, serif;
    font-size: 1.2rem;
    letter-spacing: 0.1em;
    white-space: nowrap;
    transition: opacity 0.4s ease;
  }

  .fixed-brand-logo {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0;
    height: 30px;
    transition: opacity 0.4s ease, filter 0.3s ease;
  }

  .fixed-brand-logo img {
    height: 100%;
    width: auto;
    display: block;
  }

  /* =========================
   MIDDLE RIGHT CTA
========================= */
  .overlay-middle-right-cta {
    top: 50%;
    right: 2rem;
    transform: translateY(-50%);
  }

  .cta-text {
    transition: opacity 0.3s ease;
  }

  /* =========================
   STATES
========================= */

  /* Show Logo (Middle Image + onward) */
  .state-show-logo .fixed-brand-name {
    opacity: 0;
  }
  .state-show-logo .fixed-brand-logo {
    opacity: 1;
  }

  /* LIGHT BACKGROUND (Large Image Sections) */
  .theme-light-bg {
    --overlay-color: #000000;
  }

  /* Logo becomes BLACK */
  .theme-light-bg .fixed-brand-logo {
    filter: brightness(0);
  }

  /* CTA stays WHITE on light bg */
  .theme-light-bg .overlay-middle-right-cta {
    color: #ffffff !important;
  }

  /* =========================
   RESPONSIVE
========================= */
  @media (max-width: 768px) {
    .fixed-overlay-section {
      display: none;
    }
  }
{%- endstyle -%}

<div class="fixed-overlay-section" id="FixedOverlay-{{ section.id }}">
  <div class="overlay-content">
    <!-- TOP LEFT MENU -->
    <div class="overlay-item overlay-top-left">
      {% if section.settings.menu != blank %}
        {% for link in linklists[section.settings.menu].links %}
          <a href="{{ link.url }}">{{ link.title }}</a>
        {% endfor %}
      {% else %}
        <a href="#">Shop</a>
        <a href="#">Lookbook</a>
        <a href="#">About</a>
      {% endif %}
    </div>

    <!-- BOTTOM LEFT BAG -->
    <div class="overlay-item overlay-bottom-left">
      <a href="{{ routes.cart_url }}">Bag ({{ cart.item_count }})</a>
    </div>

    <!-- MIDDLE LEFT BRAND -->
    <div class="overlay-middle-left">
      <div class="brand-logo-container">
        <h2 class="fixed-brand-name">
          {{ section.settings.brand_text | default: 'ALICIA MOORE' }}
        </h2>

        <div class="fixed-brand-logo">
          {% if section.settings.logo != blank %}
            {{ section.settings.logo | image_url: height: 60 | image_tag }}
          {% endif %}
        </div>
      </div>
    </div>

    <!-- MIDDLE RIGHT CTA -->
    <div class="overlay-item overlay-middle-right-cta">
      <a href="#" class="cta-text" id="OverlayCTA">
        {{ section.settings.cta_text_1 | default: 'Explore the New Collection' }}
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const overlay = document.getElementById('FixedOverlay-{{ section.id }}');
    document.body.appendChild(overlay);

    const init = () => {
      if (!window.gsap || !window.ScrollTrigger) {
        setTimeout(init, 100);
        return;
      }

      gsap.registerPlugin(ScrollTrigger);

      const cta = document.getElementById('OverlayCTA');

      const txt1 = "{{ section.settings.cta_text_1 | default: 'Explore the New Collection' }}";
      const txt2 = "{{ section.settings.cta_text_2 | default: 'Shop Collection' }}";

      const setCTA = (text) => {
        if (cta.innerText === text) return;
        gsap.to(cta, {
          opacity: 0,
          duration: 0.2,
          onComplete: () => {
            cta.innerText = text;
            gsap.to(cta, { opacity: 1, duration: 0.2 });
          },
        });
      };

      /* DEFAULT (HORIZONTAL SCROLLER) */
      overlay.classList.remove('state-show-logo', 'theme-light-bg');
      setCTA(txt1);

      /* MIDDLE IMAGE SECTION */
      ScrollTrigger.create({
        trigger: '.middle-image-section',
        start: 'top 60%',
        end: 'bottom 60%',
        onEnter: () => {
          overlay.classList.add('state-show-logo');
          overlay.classList.remove('theme-light-bg');
          setCTA(txt2);
        },
        onLeaveBack: () => {
          overlay.classList.remove('state-show-logo', 'theme-light-bg');
          setCTA(txt1);
        },
      });

      /* LARGE IMAGE + DISPLAY SECTIONS */
      gsap.utils.toArray('.large-image-section, .large-image-display').forEach((section) => {
        ScrollTrigger.create({
          trigger: section,
          start: 'top 60%',
          end: 'bottom 60%',
          onEnter: () => {
            overlay.classList.add('state-show-logo', 'theme-light-bg');
            setCTA(txt2);
          },
          onLeaveBack: () => {
            overlay.classList.remove('theme-light-bg');
          },
          onEnterBack: () => {
            overlay.classList.add('theme-light-bg');
          },
        });
      });
    };

    init();
    document.addEventListener('shopify:section:load', init);
  });
</script>

{% schema %}
{
  "name": "Fixed Overlay Layout",
  "settings": [
    { "type": "link_list", "id": "menu", "label": "Menu" },
    { "type": "text", "id": "brand_text", "label": "Brand Text", "default": "ALICIA MOORE" },
    { "type": "image_picker", "id": "logo", "label": "Brand Logo" },
    { "type": "text", "id": "cta_text_1", "label": "CTA (Default)", "default": "Explore the New Collection" },
    { "type": "text", "id": "cta_text_2", "label": "CTA (Secondary)", "default": "Shop Collection" }
  ],
  "presets": [{ "name": "Fixed Overlay Layout" }]
}
{% endschema %}
