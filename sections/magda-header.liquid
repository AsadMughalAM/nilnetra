{%- style -%}
  /* Sticky behavior targeting the section container */
  .magda-header-sticky-host {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: #ffffff;
    /* Ensure background is opaque */
  }

  /* Base Layout (Desktop) */
  .magda-header {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    padding: 2.5rem 4rem;
    background: #ffffff;
    color: #000000;
    width: 100%;
    box-sizing: border-box;
    /* Removed margin-bottom to handle spacing via dynamic host calculation */
    transition: transform 0.3s ease;
    position: relative;
    /* Context for mega menu */
  }

  /* Left Section */
  .magda-header__left {
    display: flex;
    align-items: stretch;
    /* Stretch to avoid hover gaps */
    gap: 3rem;
  }

  /* Center Section (Logo) */
  .magda-header__center {
    display: flex;
    justify-content: center;
    white-space: nowrap;
    /* CRITICAL: Prevent logo from breaking lines */
  }

  .magda-header__logo-link {
    text-decoration: none;
    color: #000;
    display: block;
    /* Ensure it behaves correctly */
  }

  .magda-header__logo-text {
    font-family: "Big Caslon"
    , "Book Antiqua"
    , "Palatino Linotype"
    , Georgia
    , serif;
    font-size: 2.8rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    font-weight: 400;
    margin: 0;
    line-height: 1;
  }

  /* Right Section */
  .magda-header__right {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 2.5rem;
    font-size: 1.3rem;
    font-family: var(--font-body-family);
  }

  /* Desktop Elements Styles */
  .magda-nav-link {
    text-decoration: none;
    color: #1a1a1a;
    font-size: 1.3rem;
    font-family: var(--font-body-family);
    letter-spacing: 0.02em;
    transition: color 0.2s ease;
  }

  .magda-nav-link:hover {
    color: #555;
  }

  .magda-search-icon {
    display: flex;
    align-items: center;
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
  }

  .magda-search-icon svg {
    width: 16px;
    height: 16px;
    fill: none;
    stroke: currentColor;
    stroke-width: 1.5;
  }

  .magda-currency {
    color: #1a1a1a;
    cursor: pointer;
  }

  .magda-cart-link {
    display: flex;
    align-items: center;
    text-decoration: none;
    color: #1a1a1a;
    gap: 0.8rem;
  }

  .magda-cart-count {
    background: #000;
    color: #fff;
    font-size: 1rem;
    font-weight: 600;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }

  /* Ensure drawer styles are loaded */
  header-drawer {
    display: flex;
    margin-right: 0;
    /* Align perfectly */
  }

  /* Reset button styles for drawer trigger if needed */
  .header__icon {
    color: currentColor;
    text-decoration: none;
    background: none;
    border: none;
    padding: 0;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  /* Mega Menu Styles */
  .magda-nav-item {
    display: flex;
    align-items: center;
    position: static;
    /* Full width */
    height: 100%;
  }

  .magda-mega-menu {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background: #ffffff;
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    z-index: 999;
    padding: 2.5rem 4rem 4rem;
    box-sizing: border-box;
    box-shadow: 0 40px 100px rgba(0, 0, 0, 0.04);
    border-top: 1px solid #f9f9f9;
  }

  /* Hover Bridge */
  .magda-mega-menu::before {
    content: '';
    position: absolute;
    top: -2.5rem;
    left: 0;
    width: 100%;
    height: 2.5rem;
    background: transparent;
  }

  .magda-nav-item:hover .magda-mega-menu {
    visibility: visible;
    opacity: 1;
    pointer-events: auto;
  }

  .magda-mega-menu__inner {
    max-width: var(--page-width);
    margin: 0 auto;
  }


  /*

   --------------------------------------------------------- 
   MOBILE RESPONSIVENESS (Max-Width 990px) 
   --------------------------------------------------------- 
*/
  @media screen and (max-width: 990px) {
    .magda-header {
      /* Switch to Flexbox for easier 3-part layout on mobile */
      display: flex;
      justify-content: space-between;
      padding: 1rem 1.5rem !important;
      /* Reduced padding comfortably */
      height: 70px;
      /* Force a reasonable height */
    }

    /* Left: Hamburger */
    .magda-header__left {
      flex: 1;
      gap: 0;
      /* Reset desktop gap */
      justify-content: flex-start;
    }

    /* Hide Desktop Links on Left */
    .magda-header__left .magda-nav-item,
    .magda-header__left .magda-search-icon {
      display: none;
    }

    /* Center: Logo */
    .magda-header__center {
      flex: 0 0 auto;
    }

    .magda-header__logo-text {
      font-size: 2rem;
      /* Smaller font for mobile */
    }
    .magda-logo-img {
      max-width: 120px;
      /* Constrain image logo width */
      height: auto;
    }

    /* Right: Bag Only */
    .magda-header__right {
      flex: 1;
      gap: 0;
      justify-content: flex-end;
    }

    /* Hide Desktop Links on Right */
    .magda-header__right .magda-nav-link,
    .magda-header__right .magda-currency {
      display: none;
      /* Hide 'Boutique', 'Assistance', 'PK/PKR' */
    }

    /* Ensure Drawer Toggle is Visible */
    header-drawer {
      display: block;
    }
  }

  /* DESKTOP (Min-Width 991px) */
  @media screen and (min-width: 991px) {
    header-drawer {
      display: none;
      /* Hide drawer on desktop */
    }

    #smooth-content {
      padding-top: var(--magda-header-height, 100px);
    }
  }

  /* Global fix for pages without smooth-content as well */
  #MainContent {
    padding-top: var(--magda-header-height, 0);
  }

  /* Reset padding for homepage if header is hidden there */
  /* Simple Collection Dropdown Styles */.magda-nav-item.has-simple-dropdown {
    position: relative;
  }

  .magda-nav-item.has-simple-dropdown:hover .magda-simple-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    pointer-events: auto;
  }

  .magda-simple-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 240px;
    background: #ffffff;
    padding: 1.5rem 0;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.06);
    border: 1px solid #f5f5f5;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 1001;
    pointer-events: none;
    text-align: left;
  }

  .magda-simple-dropdown__list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .magda-simple-dropdown__item {
    display: block;
    margin: 0;
  }

  .magda-simple-dropdown__link {
    display: block;
    padding: 0.8rem 2.5rem;
    font-family: var(--font-body-family);
    font-size: 0.95rem;
    color: #555;
    text-decoration: none;
    transition: all 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 400;
  }

  .magda-simple-dropdown__link:hover {
    background: #f9f9f9;
    color: #000;
    padding-left: 2.8rem;
    /* Subtle shift */
  }

  .template-index #MainContent,
  .template-index #smooth-content {
    padding-top: 0 !important;
  }
{%- endstyle -%}

<link
  rel="stylesheet"
  href="{{ 'component-menu-drawer.css' | asset_url }}"
  media="print"
  onload="this.media='all'">
<script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>

<header class="magda-header header-wrapper">
  <div class="magda-header__left">
    {% render 'header-drawer' %}

    {%- if section.settings.menu_left != blank -%}
      {%- for link in section.settings.menu_left.links -%}
        {%- assign link_handle = link.title | downcase -%}
        <div class="magda-nav-item {% if link_handle == 'catalog' %}has-simple-dropdown{% endif %}">
          <a href="{{ link.url }}" class="magda-nav-link text-body">{{ link.title }}</a>
          {%- if link_handle == 'catalog' -%}
            {% render 'simple-collection-dropdown' %}
          {%- elsif link_handle == 'collections' or link_handle == 'shop' -%}
            {% render 'magda-mega-menu' %}
          {%- endif -%}
        </div>
      {%- endfor -%}
    {%- else -%}
      <!-- Fallback links if no menu selected -->
      <div class="magda-nav-item">
        <a href="/collections/all" class="magda-nav-link">Shop</a>
        {% render 'magda-mega-menu' %}
      </div>
      <div class="magda-nav-item">
        <a href="/pages/highlights" class="magda-nav-link">Highlights</a>
      </div>
      <div class="magda-nav-item">
        <a href="/features" class="magda-nav-link">Explore</a>
      </div>
    {%- endif -%}

    <button class="magda-search-icon" aria-label="Search">
      <svg
        aria-hidden="true"
        focusable="false"
        role="presentation"
        viewBox="0 0 24 24">
        <path
          d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round" />
        <path
          d="M21 21L16.65 16.65"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round" />
      </svg>
    </button>
  </div>

  <div class="magda-header__center">
    <a href="{{ routes.root_url }}" class="magda-header__logo-link">
      {%- if section.settings.logo != blank -%}
        {{ section.settings.logo | image_url: width: 300 | image_tag: class: 'magda-logo-img', alt: shop.name }}
      {%- else -%}
        <h1 class="magda-header__logo-text">{{ shop.name }}</h1>
      {%- endif -%}
    </a>
  </div>

  <div class="magda-header__right">

    {%- if section.settings.menu_right != blank -%}
      {%- for link in section.settings.menu_right.links -%}
        <a href="{{ link.url }}" class="magda-nav-link">{{ link.title }}</a>
      {%- endfor -%}
    {%- endif -%}

    <a
      href="{{ routes.cart_url }}"
      class="magda-cart-link"
      id="cart-icon-bubble">
      <span>Bag</span>
      <span class="magda-cart-count">{{ cart.item_count }}</span>
    </a>
  </div>
</header>
<script>
  // Simple search toggle if needed, or link to search page
  document.querySelector('.magda-search-icon').addEventListener('click', function(e) {
     e.preventDefault();
     window.location.href = "{{ routes.search_url }}";
  });
  
  // CRITICAL: Dynamic Header Height Calculation
  // This ensures that content is never hidden behind the sticky header
  const updateMagdaHeaderHeight = () => {
    // Find the sticky host (which may include announcement bar if they share the sticky context)
    const headerHost = document.querySelector('.magda-header-sticky-host');
    const utilityBar = document.querySelector('.utility-bar'); // Dawn's announcement bar class
    
    let totalHeight = 0;
    if (headerHost) totalHeight += headerHost.offsetHeight;
    if (utilityBar && !headerHost.contains(utilityBar)) {
       // If utility bar is separate and fixed/sticky
       const style = window.getComputedStyle(utilityBar);
       if (style.position === 'fixed' || style.position === 'sticky') {
         // totalHeight += utilityBar.offsetHeight;
       }
    }
  
    if (totalHeight > 0) {
      document.documentElement.style.setProperty('--magda-header-height', totalHeight + 'px');
    }
  };
  
  window.addEventListener('resize', updateMagdaHeaderHeight);
  window.addEventListener('load', updateMagdaHeaderHeight);
  // Initial run
  setTimeout(updateMagdaHeaderHeight, 100); 
  // Delayed run to catch late-loading images/fonts
  setTimeout(updateMagdaHeaderHeight, 1000);
</script>

{% schema %}
  {
    "name": "Magda Header",
    "class": "magda-header-sticky-host section-header",
    "settings": [
      {
        "type": "image_picker",
        "id": "logo",
        "label": "Logo"
      },
      {
        "type": "link_list",
        "id": "menu_left",
        "label": "Left Menu",
        "default": "main-menu"
      },
      {
        "type": "link_list",
        "id": "menu_right",
        "label": "Right Menu"
      },
      {
        "type": "link_list",
        "id": "menu",
        "label": "Mobile Menu (Drawer)",
        "default": "main-menu"
      }, {
        "type": "color_scheme",
        "id": "menu_color_scheme",
        "label": "Mobile Menu Color Scheme",
        "default": "scheme-1"
      }
    ],
    "presets": [
      {
        "name": "Magda Header"
      }
    ]
  }
{% endschema %}